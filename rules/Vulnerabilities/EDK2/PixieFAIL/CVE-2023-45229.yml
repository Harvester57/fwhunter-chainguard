CVE-2023-45229:
  meta:
    author: Binarly (https://github.com/binarly-io/FwHunt)
    license: CC0-1.0
    name: CVE-2023-45229
    namespace: vulnerabilities
    advisory: https://blog.quarkslab.com/pixiefail-nine-vulnerabilities-in-tianocores-edk-ii-ipv6-network-stack.html
    description: Integer underflow when processing IA_NA/IA_TA options in a DHCPv6 Advertise message
    CVSS score: 6.5 Medium
    architecture: X86:LE:64
    tags:
      - kind: sdk
        value: EDK2
    volume guids:
      - 95E3669D-34BE-4775-A651-7EA41B69D89E
  variants:
    variants1:
      code:
        - pattern: 488b4424..488b004883c0..48894424..488b4c24..488b094883c1..e8........0fb7c8e8........0fb7c083e8..66894424..eb..488b4424..488b004883c0..48894424..488b4c24..488b094883c1..e8........0fb7c8e8........0fb7c083e8..66894424..0fb75424..6641b8....488b4c24..e8
            # 488b442450                          mov     rax, [rsp+38h+arg_10]
            # 488b00                              mov     rax, [rax]
            # 4883c010                            add     rax, 10h
            # 4889442428                          mov     [rsp+38h+IaInnerOpt], rax
            # 488b4c2450                          mov     rcx, [rsp+38h+arg_10]
            # 488b09                              mov     rcx, [rcx]
            # 4883c102                            add     rcx, 2; Buffer
            # e819600000                          call    ReadUnaligned16
            # 0fb7c8                              movzx   ecx, ax
            # e811620000                          call    NTOHS
            # 0fb7c0                              movzx   eax, ax
            # 83e80c                              sub     eax, 0Ch
            # 6689442420                          mov     [rsp+38h+IaInnerLen], ax
            # eb35                                jmp     short loc_4441
            # 488b442450                          mov     rax, [rsp+38h+arg_10]
            # 488b00                              mov     rax, [rax]
            # 4883c008                            add     rax, 8
            # 4889442428                          mov     [rsp+38h+IaInnerOpt], rax
            # 488b4c2450                          mov     rcx, [rsp+38h+arg_10]
            # 488b09                              mov     rcx, [rcx]
            # 4883c102                            add     rcx, 2; Buffer
            # e8e25f0000                          call    ReadUnaligned16
            # 0fb7c8                              movzx   ecx, ax
            # e8da610000                          call    NTOHS
            # 0fb7c0                              movzx   eax, ax
            # 83e804                              sub     eax, 4
            # 6689442420                          mov     [rsp+38h+IaInnerLen], ax
            # 0fb7542420                          movzx   edx, [rsp+38h+IaInnerLen]
            # 6641b80d00                          mov     r8w, 0Dh
            # 488b4c2428                          mov     rcx, [rsp+38h+IaInnerOpt]
            # e8cbe3ffff                          call    Dhcp6SeekOption
    variants2:
      code:
        - pattern: 450fb750..b8........6641c1c2..664183ea..eb..440fb750..8bdd6641c1c2..448bdd66442bd7b8........4a8d3c00410fb7d2488bcf41b8........e8
            # 450fb75002                          movzx   r10d, word ptr [r8+2]
            # b810000000                          mov     eax, 10h
            # 6641c1c208                          rol     r10w, 8
            # 664183ea0c                          sub     r10w, 0Ch
            # eb18                                jmp     short loc_33FE
            # 440fb75002                          movzx   r10d, word ptr [rax+2]
            # 8bdd                                mov     ebx, ebp
            # 6641c1c208                          rol     r10w, 8
            # 448bdd                              mov     r11d, ebp
            # 66442bd7                            sub     r10w, di
            # b808000000                          mov     eax, 8
            # 4a8d3c00                            lea     rdi, [rax+r8]
            # 410fb7d2                            movzx   edx, r10w
            # 488bcf                              mov     rcx, rdi
            # 41b80d000000                        mov     r8d, 0Dh
            # e864e6ffff                          call    Dhcp6SeekOption1
