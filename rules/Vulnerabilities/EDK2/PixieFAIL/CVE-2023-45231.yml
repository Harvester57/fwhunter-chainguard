CVE-2023-45231:
  meta:
    author: Binarly (https://github.com/binarly-io/FwHunt)
    license: CC0-1.0
    name: CVE-2023-45231
    namespace: vulnerabilities
    advisory: https://blog.quarkslab.com/pixiefail-nine-vulnerabilities-in-tianocores-edk-ii-ipv6-network-stack.html
    description: Out of Bounds read when handling a ND Redirect message with truncated options
    CVSS score: 6.5 Medium
    architecture: X86:LE:64
    tags:
      - kind: sdk
        value: EDK2
    volume guids:
      - 5BEDB5CC-D830-4EB2-8742-2D4CC9B54F2C
  variants:
    variant1:
      code:
        - pattern: 66895424..48894c24..4883ec..33c0668904240fb70c240fb74424..3bc80f8d
            # The bugfix checks "OptionLen < sizeof (IP6_OPTION_HEADER)" before the while loop.
            # If we don't find this check then Ip6IsNDOptionValid is vulnerable.
            # 6689542410                          mov     [rsp+arg_8], dx
            # 48894c2408                          mov     [rsp+arg_0], rcx
            # 4883ec18                            sub     rsp, 18h
            # 33c0                                xor     eax, eax
            # 66890424                            mov     word ptr [rsp+18h+Offset], ax
            # 0fb70c24                            movzx   ecx, word ptr [rsp+18h+Offset]
            # 0fb7442428                          movzx   eax, [rsp+18h+arg_8]
            # 3bc8                                cmp     ecx, eax
            # 0f8d80000000                        jge     loc_165F5
    variant2:
      code:
        - pattern: 4533d2440fb7ca450fb7c266443bd273..410fb7c00fb65401..66c1e2..803c08..74..803c08..74..6685d275
           # 4533d2                              xor     r10d, r10d
           # 440fb7ca                            movzx   r9d, dx
           # 450fb7c2                            movzx   r8d, r10w
           # 66443bd2                            cmp     r10w, dx
           # 7337                                jnb     short loc_C9E4
           # 410fb7c0                            movzx   eax, r8w
           # 0fb6540101                          movzx   edx, byte ptr [rcx+rax+1]
           # 66c1e203                            shl     dx, 3
           # 803c0803                            cmp     byte ptr [rax+rcx], 3
           # 7414                                jz      short loc_C9D4
           # 803c0805                            cmp     byte ptr [rax+rcx], 5
           # 7408                                jz      short loc_C9CE
           # 6685d2                              test    dx, dx
           # 750f                                jnz     short loc_C9DA
