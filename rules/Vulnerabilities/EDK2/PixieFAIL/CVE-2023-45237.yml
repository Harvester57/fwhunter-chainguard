CVE-2023-45237:
  meta:
    author: Binarly (https://github.com/binarly-io/FwHunt)
    license: CC0-1.0
    name: CVE-2023-45237
    namespace: vulnerabilities
    advisory: https://blog.quarkslab.com/pixiefail-nine-vulnerabilities-in-tianocores-edk-ii-ipv6-network-stack.html
    description: Use of a Weak PseudoRandom Number Generator
    CVSS score: 5.3 Medium
    architecture: X86:LE:64
    tags:
      - kind: sdk
        value: EDK2
    volume guids:
      - 1A7E4468-2F55-4A56-903C-01265EB7622B
  variants:
    variant1:
      code:
        and:
          - pattern: 33d2488d4c24..488b05........ff50..0fb64424..c1e0..0fb64c24..c1e1..0bc10fb64c24..c1e1..0bc10fb64c24..0bc1894424..8b4c24..8b4424..33c1894424..0fb74c24..c1e1..8b4424..33c1894424..488d4c24..488b05........ff90........448b5c24..8b4424..4103c3894424..8b4424
              # 33d2                                xor     edx, edx; Capabilities
              # 488d4c2430                          lea     rcx, [rsp+48h+Time]; Time
              # 488b0526c40000                      mov     rax, cs:gRT
              # ff5018                              call    [rax+EFI_RUNTIME_SERVICES.GetTime]; gRT->GetTime()
              # 0fb6442434                          movzx   eax, [rsp+48h+Time.Hour]
              # c1e018                              shl     eax, 18h
              # 0fb64c2433                          movzx   ecx, [rsp+48h+Time.Day]
              # c1e110                              shl     ecx, 10h
              # 0bc1                                or      eax, ecx
              # 0fb64c2435                          movzx   ecx, [rsp+48h+Time.Minute]
              # c1e108                              shl     ecx, 8
              # 0bc1                                or      eax, ecx
              # 0fb64c2436                          movzx   ecx, [rsp+48h+Time.Second]
              # 0bc1                                or      eax, ecx
              # 89442428                            mov     [rsp+48h+Seed], eax
              # 8b4c2438                            mov     ecx, [rsp+48h+Time.Nanosecond]
              # 8b442428                            mov     eax, [rsp+48h+Seed]
              # 33c1                                xor     eax, ecx
              # 89442428                            mov     [rsp+48h+Seed], eax
              # 0fb74c2430                          movzx   ecx, [rsp+48h+Time.Year]
              # c1e107                              shl     ecx, 7
              # 8b442428                            mov     eax, [rsp+48h+Seed]
              # 33c1                                xor     eax, ecx
              # 89442428                            mov     [rsp+48h+Seed], eax
              # 488d4c2420                          lea     rcx, [rsp+48h+Count]; Count
              # 488b05c8c30000                      mov     rax, cs:gBS
              # ff90f0000000                        call    [rax+EFI_BOOT_SERVICES.GetNextMonotonicCount]; gBS->GetNextMonotonicCount()
              # 448b5c2420                          mov     r11d, dword ptr [rsp+48h+Count]
              # 8b442428                            mov     eax, [rsp+48h+Seed]
              # 4103c3                              add     eax, r11d
              # 89442428                            mov     [rsp+48h+Seed], eax
              # 8b442428                            mov     eax, [rsp+48h+Seed]
    variant2:
      code:
        - pattern: 488b05........488d4d..33d2ff50..0fb645..488d4d..0fb65d..c1e3..0bd80fb645..c1e3..0bd80fb645..c1e3..0bd80fb745..c1e0..33d8488b05........335d..ff90........8b4d..33d203cb
             # 488b05d6af0000                      mov     rax, cs:gRT
             # 488d4df0                            lea     rcx, [rbp+Time]; Time
             # 33d2                                xor     edx, edx; Capabilities
             # ff5018                              call    [rax+EFI_RUNTIME_SERVICES.GetTime]; gRT->GetTime()
             # 0fb645f3                            movzx   eax, [rbp+Time.Day]
             # 488d4d38                            lea     rcx, [rbp+Count]; Count
             # 0fb65df4                            movzx   ebx, [rbp+Time.Hour]
             # c1e308                              shl     ebx, 8
             # 0bd8                                or      ebx, eax
             # 0fb645f5                            movzx   eax, [rbp+Time.Minute]
             # c1e308                              shl     ebx, 8
             # 0bd8                                or      ebx, eax
             # 0fb645f6                            movzx   eax, [rbp+Time.Second]
             # c1e308                              shl     ebx, 8
             # 0bd8                                or      ebx, eax
             # 0fb745f0                            movzx   eax, [rbp+Time.Year]
             # c1e007                              shl     eax, 7
             # 33d8                                xor     ebx, eax
             # 488b0592af0000                      mov     rax, cs:gBS
             # 335df8                              xor     ebx, [rbp+Time.Nanosecond]
             # ff90f0000000                        call    [rax+EFI_BOOT_SERVICES.GetNextMonotonicCount]; gBS->GetNextMonotonicCount()
             # 8b4d38                              mov     ecx, dword ptr [rbp+Count]
             # 33d2                                xor     edx, edx
             # 03cb                                add     ecx, ebx
