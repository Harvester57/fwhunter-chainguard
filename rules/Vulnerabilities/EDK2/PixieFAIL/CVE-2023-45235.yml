CVE-2023-45235:
  meta:
    author: Binarly (https://github.com/binarly-io/FwHunt)
    license: CC0-1.0
    name: CVE-2023-45235
    namespace: vulnerabilities
    advisory: https://blog.quarkslab.com/pixiefail-nine-vulnerabilities-in-tianocores-edk-ii-ipv6-network-stack.html
    description: Buffer overflow when handling Server ID option from a DHCPv6 proxy Advertise message
    CVSS score: 8.3 High
    architecture: X86:LE:64
    tags:
      - kind: sdk
        value: EDK2
    volume guids:
      - B95E9FDA-26DE-48D2-8807-1F9107AC5E3A
  variants:
    variant1:
      code:
        and:
          - pattern: b90404....e8........48894424..48837c24....75
              # b904040000                          mov     ecx, 404h; AllocationSize
              # e8e8530000                          call    AllocateZeroPool
              # 4889442460                          mov     [rsp+0E8h+Discover], rax
              # 48837c246000                        cmp     [rsp+0E8h+Discover], 0
              # 750f                                jnz     short loc_11144
          - pattern: 488b4424..4883c0..48898424
              # 488b442460                          mov     rax, [rsp+0E8h+Discover]
              # 4883c004                            add     rax, 4
              # 4889842488000000                    mov     [rsp+0E8h+DiscoverOpt], rax
          - pattern: 488b8424........0fb748..e8........66894424..0fb74424..83c0..4c63c0488b9424........488b8c24........e8
              # 488b8424a0000000                    mov     rax, [rsp+0E8h+Option]
              # 0fb74802                            movzx   ecx, word ptr [rax+2]
              # e8d92b0000                          call    NTOHS
              # 6689442468                          mov     [rsp+0E8h+OpLen], ax
              # 0fb7442468                          movzx   eax, [rsp+0E8h+OpLen]
              # 83c004                              add     eax, 4
              # 4c63c0                              movsxd  r8, eax; Length
              # 488b9424a0000000                    mov     rdx, [rsp+0E8h+Option]; SourceBuffer
              # 488b8c2488000000                    mov     rcx, [rsp+0E8h+DiscoverOpt]; DestinationBuffer
              # e8a4270000                          call    CopyMem
    variant2:
      code:
        and:
          - pattern: b90404....e8
              # b904040000                          mov     ecx, 404h; AllocationSize
              # e83a1b0000                          call    AllocateZeroPool
          - pattern: 4885d274..0fb742..66c1c0..440fb7f04503f0483bf274..458bc6488bcee8
              # 4885d2                              test    rdx, rdx
              # 74ec                                jz      short loc_A54F
              # 0fb74202                            movzx   eax, word ptr [rdx+2]
              # 66c1c008                            rol     ax, 8
              # 440fb7f0                            movzx   r14d, ax
              # 4503f0                              add     r14d, r8d
              # 483bf2                              cmp     rsi, rdx
              # 7413                                jz      short loc_A58A
              # 458bc6                              mov     r8d, r14d; Length
              # 488bce                              mov     rcx, rsi; DestinationBuffer
              # e8fe5cffff                          call    CopyMem
